"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.getMockApiConnector = getMockApiConnector;
exports.setupDriver = setupDriver;
exports.doesStateHaveResponseData = doesStateHaveResponseData;
exports.getSearchCalls = getSearchCalls;
exports.getAutocompleteCalls = getAutocompleteCalls;
exports.getClickCalls = getClickCalls;
exports.getAutocompleteClickCalls = getAutocompleteClickCalls;
exports.waitATick = waitATick;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _objectWithoutProperties2 = _interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties"));

var _SearchDriver = _interopRequireDefault(require("../SearchDriver"));

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { (0, _defineProperty2.default)(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }

var suggestions = {
  documents: [{
    suggestion: "carlsbad"
  }, {
    suggestion: "carlsbad caverns"
  }, {
    suggestion: "carolina"
  }]
};
var searchResponse = {
  totalResults: 1000,
  totalPages: 100,
  requestId: "12345",
  facets: {},
  results: [{}, {}]
};
var autocompleteSearchResponse = {
  requestId: "6789",
  results: [{}, {}]
};

function getMockApiConnector() {
  return {
    onAutocomplete: jest.fn().mockReturnValue({
      then: function then(cb) {
        return cb({
          autocompletedResults: autocompleteSearchResponse.results,
          autocompletedResultsRequestId: autocompleteSearchResponse.requestId,
          autocompletedSuggestions: suggestions
        });
      }
    }),
    onSearch: jest.fn().mockReturnValue({
      then: function then(cb) {
        return cb(searchResponse);
      }
    }),
    onResultClick: jest.fn().mockReturnValue({
      then: function then() {}
    }),
    onAutocompleteResultClick: jest.fn().mockReturnValue({
      then: function then() {}
    })
  };
}

function setupDriver() {
  var _ref = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},
      mockSearchResponse = _ref.mockSearchResponse,
      mockApiConnector = _ref.mockApiConnector,
      rest = (0, _objectWithoutProperties2.default)(_ref, ["mockSearchResponse", "mockApiConnector"]);

  mockApiConnector = mockApiConnector || getMockApiConnector();

  if (mockSearchResponse) {
    mockApiConnector.onSearch = jest.fn().mockReturnValue({
      then: function then(cb) {
        return cb(mockSearchResponse);
      }
    });
  }

  var driver = new _SearchDriver.default(_objectSpread(_objectSpread({
    apiConnector: mockApiConnector
  }, rest), {}, {
    // We don't want to deal with async in our tests, so pass 0 so URL state
    // pushes happen synchronously
    urlPushDebounceLength: 0
  }));
  var updatedStateAfterAction = {};
  driver.subscribeToStateChanges(function (newState) {
    updatedStateAfterAction.state = newState;
  });
  jest.runAllTimers();
  return {
    stateAfterCreation: driver.getState(),
    driver: driver,
    updatedStateAfterAction: updatedStateAfterAction,
    mockApiConnector: mockApiConnector
  };
}

function doesStateHaveResponseData(response) {
  var requestId = response.requestId,
      results = response.results,
      totalPages = response.totalPages,
      totalResults = response.totalResults,
      wasSearched = response.wasSearched;
  return !!results && results.length && !!requestId && totalPages > 0 && totalResults > 0 && !!wasSearched;
}

function getSearchCalls(mockApiConnector) {
  return mockApiConnector.onSearch.mock.calls;
}

function getAutocompleteCalls(mockApiConnector) {
  return mockApiConnector.onAutocomplete.mock.calls;
}

function getClickCalls(mockApiConnector) {
  return mockApiConnector.onResultClick.mock.calls;
}

function getAutocompleteClickCalls(mockApiConnector) {
  return mockApiConnector.onAutocompleteResultClick.mock.calls;
}
/**
 * Returns a promise that resolves after the current event loop.
 *
 * Useful for writing `await waitATick()` to wait for a promise to resolve.
 */


function waitATick() {
  var promiseResolve;
  var promise = new Promise(function (resolve) {
    return promiseResolve = resolve;
  });
  setTimeout(function () {
    return promiseResolve();
  });
  jest.runAllTimers();
  return promise;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy90ZXN0L2hlbHBlcnMuanMiXSwibmFtZXMiOlsic3VnZ2VzdGlvbnMiLCJkb2N1bWVudHMiLCJzdWdnZXN0aW9uIiwic2VhcmNoUmVzcG9uc2UiLCJ0b3RhbFJlc3VsdHMiLCJ0b3RhbFBhZ2VzIiwicmVxdWVzdElkIiwiZmFjZXRzIiwicmVzdWx0cyIsImF1dG9jb21wbGV0ZVNlYXJjaFJlc3BvbnNlIiwiZ2V0TW9ja0FwaUNvbm5lY3RvciIsIm9uQXV0b2NvbXBsZXRlIiwiamVzdCIsImZuIiwibW9ja1JldHVyblZhbHVlIiwidGhlbiIsImNiIiwiYXV0b2NvbXBsZXRlZFJlc3VsdHMiLCJhdXRvY29tcGxldGVkUmVzdWx0c1JlcXVlc3RJZCIsImF1dG9jb21wbGV0ZWRTdWdnZXN0aW9ucyIsIm9uU2VhcmNoIiwib25SZXN1bHRDbGljayIsIm9uQXV0b2NvbXBsZXRlUmVzdWx0Q2xpY2siLCJzZXR1cERyaXZlciIsIm1vY2tTZWFyY2hSZXNwb25zZSIsIm1vY2tBcGlDb25uZWN0b3IiLCJyZXN0IiwiZHJpdmVyIiwiU2VhcmNoRHJpdmVyIiwiYXBpQ29ubmVjdG9yIiwidXJsUHVzaERlYm91bmNlTGVuZ3RoIiwidXBkYXRlZFN0YXRlQWZ0ZXJBY3Rpb24iLCJzdWJzY3JpYmVUb1N0YXRlQ2hhbmdlcyIsIm5ld1N0YXRlIiwic3RhdGUiLCJydW5BbGxUaW1lcnMiLCJzdGF0ZUFmdGVyQ3JlYXRpb24iLCJnZXRTdGF0ZSIsImRvZXNTdGF0ZUhhdmVSZXNwb25zZURhdGEiLCJyZXNwb25zZSIsIndhc1NlYXJjaGVkIiwibGVuZ3RoIiwiZ2V0U2VhcmNoQ2FsbHMiLCJtb2NrIiwiY2FsbHMiLCJnZXRBdXRvY29tcGxldGVDYWxscyIsImdldENsaWNrQ2FsbHMiLCJnZXRBdXRvY29tcGxldGVDbGlja0NhbGxzIiwid2FpdEFUaWNrIiwicHJvbWlzZVJlc29sdmUiLCJwcm9taXNlIiwiUHJvbWlzZSIsInJlc29sdmUiLCJzZXRUaW1lb3V0Il0s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QixnQkFBbkMsRUFBcUQ7QUFDMUQsU0FBT0EsZ0JBQWdCLENBQUNILHlCQUFqQixDQUEyQ3FCLElBQTNDLENBQWdEQyxLQUF2RDtBQUNEO0FBRUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBQ08sU0FBU0ksU0FBVCxHQUFxQjtBQUMxQixNQUFJQyxjQUFKO0FBQ0EsTUFBTUMsT0FBTyxHQUFHLElBQUlDLE9BQUosQ0FBWSxVQUFBQyxPQUFPO0FBQUEsV0FBS0gsY0FBYyxHQUFHRyxPQUF0QjtBQUFBLEdBQW5CLENBQWhCO0FBQ0FDLEVBQUFBLFVBQVUsQ0FBQztBQUFBLFdBQU1KLGNBQWMsRUFBcEI7QUFBQSxHQUFELENBQVY7QUFDQXJDLEVBQUFBLElBQUksQ0FBQ3VCLFlBQUw7QUFDQSxTQUFPZSxPQUFQO0FBQ0QiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgU2VhcmNoRHJpdmVyIGZyb20gXCIuLi9TZWFyY2hEcml2ZXJcIjtcblxuY29uc3Qgc3VnZ2VzdGlvbnMgPSB7XG4gIGRvY3VtZW50czogW1xuICAgIHtcbiAgICAgIHN1Z2dlc3Rpb246IFwiY2FybHNiYWRcIlxuICAgIH0sXG4gICAge1xuICAgICAgc3VnZ2VzdGlvbjogXCJjYXJsc2JhZCBjYXZlcm5zXCJcbiAgICB9LFxuICAgIHtcbiAgICAgIHN1Z2dlc3Rpb246IFwiY2Fyb2xpbmFcIlxuICAgIH1cbiAgXVxufTtcblxuY29uc3Qgc2VhcmNoUmVzcG9uc2UgPSB7XG4gIHRvdGFsUmVzdWx0czogMTAwMCxcbiAgdG90YWxQYWdlczogMTAwLFxuICByZXF1ZXN0SWQ6IFwiMTIzNDVcIixcbiAgZmFjZXRzOiB7fSxcbiAgcmVzdWx0czogW3t9LCB7fV1cbn07XG5cbmNvbnN0IGF1dG9jb21wbGV0ZVNlYXJjaFJlc3BvbnNlID0ge1xuICByZXF1ZXN0SWQ6IFwiNjc4OVwiLFxuICByZXN1bHRzOiBbe30sIHt9XVxufTtcblxuZXhwb3J0IGZ1bmN0aW9uIGdldE1vY2tBcGlDb25uZWN0b3IoKSB7XG4gIHJldHVybiB7XG4gICAgb25BdXRvY29tcGxldGU6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoe1xuICAgICAgdGhlbjogY2IgPT5cbiAgICAgICAgY2Ioe1xuICAgICAgICAgIGF1dG9jb21wbGV0ZWRSZXN1bHRzOiBhdXRvY29tcGxldGVTZWFyY2hSZXNwb25zZS5yZXN1bHRzLFxuICAgICAgICAgIGF1dG9jb21wbGV0ZWRSZXN1bHRzUmVxdWVzdElkOiBhdXRvY29tcGxldGVTZWFyY2hSZXNwb25zZS5yZXF1ZXN0SWQsXG4gICAgICAgICAgYXV0b2NvbXBsZXRlZFN1Z2dlc3Rpb25zOiBzdWdnZXN0aW9uc1xuICAgICAgICB9KVxuICAgIH0pLFxuICAgIG9uU2VhcmNoOiBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKHsgdGhlbjogY2IgPT4gY2Ioc2VhcmNoUmVzcG9uc2UpIH0pLFxuICAgIG9uUmVzdWx0Q2xpY2s6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoeyB0aGVuOiAoKSA9PiB7fSB9KSxcbiAgICBvbkF1dG9jb21wbGV0ZVJlc3VsdENsaWNrOiBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKHsgdGhlbjogKCkgPT4ge30gfSlcbiAgfTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHNldHVwRHJpdmVyKHtcbiAgbW9ja1NlYXJjaFJlc3BvbnNlLFxuICBtb2NrQXBpQ29ubmVjdG9yLFxuICAuLi5yZXN0XG59ID0ge30pIHtcbiAgbW9ja0FwaUNvbm5lY3RvciA9IG1vY2tBcGlDb25uZWN0b3IgfHwgZ2V0TW9ja0FwaUNvbm5lY3RvcigpO1xuXG4gIGlmIChtb2NrU2VhcmNoUmVzcG9uc2UpIHtcbiAgICBtb2NrQXBpQ29ubmVjdG9yLm9uU2VhcmNoID0gamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7XG4gICAgICB0aGVuOiBjYiA9PiBjYihtb2NrU2VhcmNoUmVzcG9uc2UpXG4gICAgfSk7XG4gIH1cblxuICBjb25zdCBkcml2ZXIgPSBuZXcgU2VhcmNoRHJpdmVyKHtcbiAgICBhcGlDb25uZWN0b3I6IG1vY2tBcGlDb25uZWN0b3IsXG4gICAgLy8gUGFzcywgZS5nLiwgaW5pdGlhbFN0YXRlIGFuZCBhbGwgb3RoZXIgY29uZmlnc1xuICAgIC4uLnJlc3QsXG4gICAgLy8gV2UgZG9uJ3Qgd2FudCB0byBkZWFsIHdpdGggYXN5bmMgaW4gb3VyIHRlc3RzLCBzbyBwYXNzIDAgc28gVVJMIHN0YXRlXG4gICAgLy8gcHVzaGVzIGhhcHBlbiBzeW5jaHJvbm91c2x5XG4gICAgdXJsUHVzaERlYm91bmNlTGVuZ3RoOiAwXG4gIH0pO1xuXG4gIGNvbnN0IHVwZGF0ZWRTdGF0ZUFmdGVyQWN0aW9uID0ge307XG4gIGRyaXZlci5zdWJzY3JpYmVUb1N0YXRlQ2hhbmdlcyhuZXdTdGF0ZSA9PiB7XG4gICAgdXBkYXRlZFN0YXRlQWZ0ZXJBY3Rpb24uc3RhdGUgPSBuZXdTdGF0ZTtcbiAgfSk7XG5cbiAgamVzdC5ydW5BbGxUaW1lcnMoKTtcblxuICByZXR1cm4ge1xuICAgIHN0YXRlQWZ0ZXJDcmVhdGlvbjogZHJpdmVyLmdldFN0YXRlKCksXG4gICAgZHJpdmVyLFxuICAgIHVwZGF0ZWRTdGF0ZUFmdGVyQWN0aW9uLFxuICAgIG1vY2tBcGlDb25uZWN0b3JcbiAgfTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGRvZXNTdGF0ZUhhdmVSZXNwb25zZURhdGEocmVzcG9uc2UpIHtcbiAgY29uc3Qge1xuICAgIHJlcXVlc3RJZCxcbiAgICByZXN1bHRzLFxuICAgIHRvdGFsUGFnZXMsXG4gICAgdG90YWxSZXN1bHRzLFxuICAgIHdhc1NlYXJjaGVkXG4gIH0gPSByZXNwb25zZTtcbiAgcmV0dXJuIChcbiAgICAhIXJlc3VsdHMgJiZcbiAgICByZXN1bHRzLmxlbmd0aCAmJlxuICAgICEhcmVxdWVzdElkICYmXG4gICAgdG90YWxQYWdlcyA+IDAgJiZcbiAgICB0b3RhbFJlc3VsdHMgPiAwICYmXG4gICAgISF3YXNTZWFyY2hlZFxuICApO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0U2VhcmNoQ2FsbHMobW9ja0FwaUNvbm5lY3Rvcikge1xuICByZXR1cm4gbW9ja0FwaUNvbm5lY3Rvci5vblNlYXJjaC5tb2NrLmNhbGxzO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0QXV0b2NvbXBsZXRlQ2FsbHMobW9ja0FwaUNvbm5lY3Rvcikge1xuICByZXR1cm4gbW9ja0FwaUNvbm5lY3Rvci5vbkF1dG9jb21wbGV0ZS5tb2NrLmNhbGxzO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0Q2xpY2tDYWxscyhtb2NrQXBpQ29ubmVjdG9yKSB7XG4gIHJldHVybiBtb2NrQXBpQ29ubmVjdG9yLm9uUmVzdWx0Q2xpY2subW9jay5jYWxscztcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldEF1dG9jb21wbGV0ZUNsaWNrQ2FsbHMobW9ja0FwaUNvbm5lY3Rvcikge1xuICByZXR1cm4gbW9ja0FwaUNvbm5lY3Rvci5vbkF1dG9jb21wbGV0ZVJlc3VsdENsaWNrLm1vY2suY2FsbHM7XG59XG5cbi8qKlxuICogUmV0dXJucyBhIHByb21pc2UgdGhhdCByZXNvbHZlcyBhZnRlciB0aGUgY3VycmVudCBldmVudCBsb29wLlxuICpcbiAqIFVzZWZ1bCBmb3Igd3JpdGluZyBgYXdhaXQgd2FpdEFUaWNrKClgIHRvIHdhaXQgZm9yIGEgcHJvbWlzZSB0byByZXNvbHZlLlxuICovXG5leHBvcnQgZnVuY3Rpb24gd2FpdEFUaWNrKCkge1xuICBsZXQgcHJvbWlzZVJlc29sdmU7XG4gIGNvbnN0IHByb21pc2UgPSBuZXcgUHJvbWlzZShyZXNvbHZlID0+IChwcm9taXNlUmVzb2x2ZSA9IHJlc29sdmUpKTtcbiAgc2V0VGltZW91dCgoKSA9PiBwcm9taXNlUmVzb2x2ZSgpKTtcbiAgamVzdC5ydW5BbGxUaW1lcnMoKTtcbiAgcmV0dXJuIHByb21pc2U7XG59XG4iXX0=